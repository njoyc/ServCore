{% extends "base.html" %}

{% block title %}{{ 'Edit User' if action == 'edit' else 'Create User' }} - ServCore{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ 'Edit User' if action == 'edit' else 'Create New User' }}</h1>
    <a href="{{ url_for('admin.list_users') }}" class="btn btn-secondary">Back to Users</a>
</div>

<div class="card">
    <form method="POST">
        <div class="form-group">
            <label for="name">Name *</label>
            <input
                type="text"
                id="name"
                name="name"
                value="{{ user.name if user else (name or '') }}"
                class="form-control {% if errors and errors.name %}error{% endif %}"
                maxlength="100"
                required
            >
            {% if errors and errors.name %}
                <span class="error-message">{{ errors.name }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="email">Email *</label>
            <input
                type="email"
                id="email"
                name="email"
                value="{{ user.email if user else (email or '') }}"
                class="form-control {% if errors and errors.email %}error{% endif %}"
                required
            >
            {% if errors and errors.email %}
                <span class="error-message">{{ errors.email }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="password">Password {% if action == 'edit' %}(leave blank to keep current){% else %}*{% endif %}</label>
            <input
                type="password"
                id="password"
                name="password"
                class="form-control {% if errors and errors.password %}error{% endif %}"
                minlength="6"
                {% if action == 'create' %}required{% endif %}
            >
            {% if errors and errors.password %}
                <span class="error-message">{{ errors.password }}</span>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="role">Role *</label>
            <select
                id="role"
                name="role"
                class="form-control {% if errors and errors.role %}error{% endif %}"
                required
            >
                <option value="">Select role</option>
                <option value="user" {% if (user and user.role == 'user') or (role == 'user') %}selected{% endif %}>User</option>
                <option value="agent" {% if (user and user.role == 'agent') or (role == 'agent') %}selected{% endif %}>Agent</option>
                <option value="admin" {% if (user and user.role == 'admin') or (role == 'admin') %}selected{% endif %}>Admin</option>
            </select>
            {% if errors and errors.role %}
                <span class="error-message">{{ errors.role }}</span>
            {% endif %}
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">{{ 'Update User' if action == 'edit' else 'Create User' }}</button>
            <a href="{{ url_for('admin.list_users') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
